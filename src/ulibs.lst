GAS LISTING ulibs.s 			page 1


   1              	# 1 "ulibs.S"
   1              	/*
   0              	
   0              	
   2              	** sccs id:	@(#)ulibs.S	1.1	4/22/16
   3              	**
   4              	** File:	ulibs.S
   5              	**
   6              	** Author:	CSCI-452 class of 20155
   7              	**
   8              	** Contributor:
   9              	**
  10              	** Description:	assembly-language user-level library functions
  11              	*/
  12              	
  13              	#define	__SP_ASM__
  14              	
  15              	#include "syscall.h"
   1              	/*
   2              	** SCCS ID:	@(#)syscall.h	1.1	4/22/16
   3              	**
   4              	** File:	syscall.h
   5              	**
   6              	** Author:	CSCI-452 class of 20155
   7              	**
   8              	** Contributor:
   9              	**
  10              	** Description:	system call declarations
  11              	*/
  12              	
  13              	#ifndef _SYSCALL_H_
  14              	#define _SYSCALL_H_
  15              	
  16              	#include "common.h"
   1              	/*
  17              	
  16              	
  17              	/*
  18              	** System call stubs
  19              	**
  20              	** All have the same structure:
  21              	**
  22              	**      move a code into EAX
  23              	**      generate the interrupt
  24              	**      return to the caller
  25              	**
  26              	** As these are simple "leaf" routines, we don't use
  27              	** the standard enter/leave method to set up a stack
  28              	** frame - that takes time, and we don't really need it.
  29              	*/
  30              	
  31              	#define SYSCALL(name) \
  32              		.globl	name              ; \
  33              	name:                             ; \
  34              		movl	$SYS_##name, %eax ; \
  35              		int	$INT_VEC_SYSCALL  ; \
  36              		ret
GAS LISTING ulibs.s 			page 2


  37              	
  38 0000 B8000000 	SYSCALL(exit)
  38      00CD80C3 
  39 0008 B8010000 	SYSCALL(readch)
  39      00CD80C3 
  40 0010 B8020000 	SYSCALL(writes)
  40      00CD80C3 
  41 0018 B8030000 	SYSCALL(fork)
  41      00CD80C3 
  42 0020 B8040000 	SYSCALL(exec)
  42      00CD80C3 
  43 0028 B8050000 	SYSCALL(wait)
  43      00CD80C3 
  44 0030 B8060000 	SYSCALL(kill)
  44      00CD80C3 
  45 0038 B8070000 	SYSCALL(sleep)
  45      00CD80C3 
  46 0040 B8080000 	SYSCALL(getpid)
  46      00CD80C3 
  47 0048 B8090000 	SYSCALL(getppid)
  47      00CD80C3 
  48 0050 B80A0000 	SYSCALL(gettime)
  48      00CD80C3 
  49              	
  50              	// This is a bogus system call; it's here so that we can test
  51              	// our handling of out-of-range syscall codes in the syscall ISR.
  52              	
  53 0058 B86F0000 	SYSCALL(bogus)
  53      00CD80C3 
  54              	
  55              	/*
  56              	** do_exit()
  57              	**
  58              	** support function used as the "return to" address
  59              	** for user main() routines; it just calls exit(%eax)
  60              	*/
  61              	
  62              		.globl	do_exit
  63              	do_exit:
  64 0060 50       		pushl	%eax	// use whatever was in EAX as the status
  65 0061 E8FCFFFF 		call	exit	// terminate this process
  65      FF
GAS LISTING ulibs.s 			page 3


DEFINED SYMBOLS
             ulibs.S:38     .text:0000000000000000 exit
             ulibs.S:39     .text:0000000000000008 readch
             ulibs.S:40     .text:0000000000000010 writes
             ulibs.S:41     .text:0000000000000018 fork
             ulibs.S:42     .text:0000000000000020 exec
             ulibs.S:43     .text:0000000000000028 wait
             ulibs.S:44     .text:0000000000000030 kill
             ulibs.S:45     .text:0000000000000038 sleep
             ulibs.S:46     .text:0000000000000040 getpid
             ulibs.S:47     .text:0000000000000048 getppid
             ulibs.S:48     .text:0000000000000050 gettime
             ulibs.S:53     .text:0000000000000058 bogus
             ulibs.S:63     .text:0000000000000060 do_exit

NO UNDEFINED SYMBOLS
